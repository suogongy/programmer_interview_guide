# äº‘å¹³å°æœåŠ¡ - æ€»è§ˆ

## æ¦‚è¿°

äº‘è®¡ç®—å·²æˆä¸ºç°ä»£åº”ç”¨å¼€å‘å’Œéƒ¨ç½²çš„åŸºç¡€è®¾æ–½ï¼Œä¸»æµäº‘å¹³å°æä¾›äº†ä¸°å¯Œçš„æœåŠ¡æ¥æ”¯æŒå„ç§ä¸šåŠ¡åœºæ™¯ã€‚æœ¬ç« èŠ‚æ·±å…¥ä»‹ç»AWSã€Azureã€Google Cloudç­‰ä¸»è¦äº‘å¹³å°çš„æ ¸å¿ƒæœåŠ¡ï¼Œå¸®åŠ©å¼€å‘è€…é€‰æ‹©å’Œä½¿ç”¨åˆé€‚çš„äº‘æœåŠ¡ã€‚

## ğŸ“š ç« èŠ‚å†…å®¹

### 1. [AWSæ ¸å¿ƒæœåŠ¡](./aws-services.md)
- **è®¡ç®—æœåŠ¡**: EC2ã€Lambdaã€ECSã€EKSæ— æœåŠ¡å™¨è®¡ç®—
- **å­˜å‚¨æœåŠ¡**: S3ã€EBSã€EFSåˆ†å¸ƒå¼å­˜å‚¨è§£å†³æ–¹æ¡ˆ
- **æ•°æ®åº“**: RDSã€DynamoDBã€ElastiCacheæ•°æ®ç®¡ç†
- **ç½‘ç»œæœåŠ¡**: VPCã€CloudFrontã€Route 53ç½‘ç»œæ¶æ„
- **ç›‘æ§è¿ç»´**: CloudWatchã€CloudTrailã€Systems Manager

### 2. [Azureäº‘æœåŠ¡](./azure-services.md)
- **è®¡ç®—å¹³å°**: Virtual Machinesã€App Serviceã€Azure Functions
- **æ•°æ®æœåŠ¡**: Cosmos DBã€SQL Databaseã€Storage Account
- **AI/MLæœåŠ¡**: Cognitive Servicesã€Machine Learningã€Bot Service
- **å¼€å‘å·¥å…·**: Azure DevOpsã€Application Insightsã€Key Vault
- **ä¼ä¸šé›†æˆ**: Active Directoryã€Logic Appsã€Service Bus

### 3. [Google Cloudå¹³å°](./gcp-services.md)
- **è®¡ç®—å¼•æ“**: Compute Engineã€Cloud Functionsã€Cloud Run
- **å¤§æ•°æ®åˆ†æ**: BigQueryã€Dataflowã€Pub/Subæ¶ˆæ¯é˜Ÿåˆ—
- **æœºå™¨å­¦ä¹ **: AI Platformã€AutoMLã€TensorFlow Enterprise
- **å¼€å‘å·¥å…·**: Cloud Buildã€Cloud Source Repositories
- **å®‰å…¨æœåŠ¡**: Identity and Access Managementã€Security Command Center

### 4. [å¤šäº‘æ¶æ„è®¾è®¡](./multi-cloud.md)
- **äº‘å¹³å°é€‰æ‹©**: æˆæœ¬å¯¹æ¯”ã€æœåŠ¡ç‰¹è‰²ã€åœ°åŸŸè¦†ç›–
- **è¿ç§»ç­–ç•¥**: åº”ç”¨ç°ä»£åŒ–ã€æ•°æ®è¿ç§»ã€æ··åˆäº‘æ¶æ„
- **æˆæœ¬ä¼˜åŒ–**: èµ„æºè°ƒåº¦ã€é¢„ç•™å®ä¾‹ã€Spotå®ä¾‹ä½¿ç”¨
- **å®‰å…¨åˆè§„**: æ•°æ®ä¸»æƒã€åˆè§„è®¤è¯ã€å®‰å…¨æœ€ä½³å®è·µ
- **é¿å…é”å®š**: äº‘åŸç”Ÿå·¥å…·ã€å®¹å™¨åŒ–ã€æ ‡å‡†åŒ–API

### 5. [äº‘åŸç”Ÿå¼€å‘](./cloud-native.md)
- **å¾®æœåŠ¡æ¶æ„**: æœåŠ¡ç½‘æ ¼ã€APIç½‘å…³ã€æœåŠ¡å‘ç°
- **å®¹å™¨ç¼–æ’**: Kubernetesã€Dockerã€HelmåŒ…ç®¡ç†
- **DevOpsæµç¨‹**: CI/CDæµæ°´çº¿ã€åŸºç¡€è®¾æ–½å³ä»£ç 
- **å¯è§‚æµ‹æ€§**: åˆ†å¸ƒå¼è¿½è¸ªã€æ—¥å¿—èšåˆã€æŒ‡æ ‡ç›‘æ§
- **å®‰å…¨é˜²æŠ¤**: å®¹å™¨å®‰å…¨ã€å¯†é’¥ç®¡ç†ã€ç½‘ç»œç­–ç•¥

## ğŸ¯ ä¸»æµäº‘å¹³å°å¯¹æ¯”

### æœåŠ¡åŠŸèƒ½å¯¹æ¯”

#### æ ¸å¿ƒæœåŠ¡å¯¹æ¯”è¡¨
| æœåŠ¡ç±»å‹ | AWS | Azure | Google Cloud | ç‰¹ç‚¹ |
|----------|-----|-------|--------------|------|
| **è®¡ç®—** | EC2, Lambda | VM, Functions | Compute Engine, Cloud Functions | å¼¹æ€§æ‰©å®¹ |
| **å­˜å‚¨** | S3, EBS | Blob Storage, Disk | Cloud Storage, Persistent Disk | é«˜å¯ç”¨æ€§ |
| **æ•°æ®åº“** | RDS, DynamoDB | SQL DB, Cosmos DB | Cloud SQL, Firestore | æ‰˜ç®¡æœåŠ¡ |
| **AI/ML** | SageMaker | ML Studio | AI Platform | æ¨¡å‹è®­ç»ƒ |
| **å®¹å™¨** | EKS, ECS | AKS, Container Instances | GKE, Cloud Run | å®¹å™¨ç¼–æ’ |

### æˆæœ¬ä¼˜åŒ–ç­–ç•¥

#### AWSæˆæœ¬ä¼˜åŒ–
```
è®¡ç®—ä¼˜åŒ–:
â€¢ Reserved Instances - é¢„ç•™å®ä¾‹èŠ‚çœæˆæœ¬
â€¢ Spot Instances - ç«ä»·å®ä¾‹é™ä½è´¹ç”¨
â€¢ Auto Scaling - è‡ªåŠ¨æ‰©ç¼©å®¹
â€¢ Right Sizing - åˆç†é…ç½®èµ„æº

å­˜å‚¨ä¼˜åŒ–:
â€¢ S3 Storage Classes - æ™ºèƒ½å­˜å‚¨åˆ†å±‚
â€¢ Lifecycle Policies - ç”Ÿå‘½å‘¨æœŸç®¡ç†
â€¢ Data Compression - æ•°æ®å‹ç¼©
â€¢ CloudFront CDN - å‡å°‘æ•°æ®ä¼ è¾“
```

## ğŸ’¡ AWSå®è·µæ¡ˆä¾‹

### æ— æœåŠ¡å™¨Webåº”ç”¨æ¶æ„

#### Lambda + API Gateway + DynamoDB
```python
import json
import boto3
from decimal import Decimal

# DynamoDBè¿æ¥
dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('todos')

def lambda_handler(event, context):
    http_method = event['httpMethod']
    path = event['path']
    
    try:
        if http_method == 'GET' and path == '/todos':
            # è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹
            response = table.scan()
            items = response['Items']
            
            # è½¬æ¢Decimalç±»å‹ä¸ºfloat
            for item in items:
                for key, value in item.items():
                    if isinstance(value, Decimal):
                        item[key] = float(value)
            
            return {
                'statusCode': 200,
                'headers': {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                },
                'body': json.dumps(items)
            }
            
        elif http_method == 'POST' and path == '/todos':
            # åˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹
            body = json.loads(event['body'])
            
            item = {
                'id': context.aws_request_id,
                'title': body['title'],
                'completed': False,
                'created_at': int(time.time())
            }
            
            table.put_item(Item=item)
            
            return {
                'statusCode': 201,
                'headers': {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                },
                'body': json.dumps(item, default=str)
            }
            
        elif http_method == 'PUT' and '/todos/' in path:
            # æ›´æ–°å¾…åŠäº‹é¡¹
            todo_id = path.split('/')[-1]
            body = json.loads(event['body'])
            
            table.update_item(
                Key={'id': todo_id},
                UpdateExpression='SET completed = :completed',
                ExpressionAttributeValues={':completed': body['completed']}
            )
            
            return {
                'statusCode': 200,
                'headers': {
                    'Access-Control-Allow-Origin': '*'
                },
                'body': json.dumps({'message': 'Updated successfully'})
            }
            
    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({'error': str(e)})
        }
```

### CloudFormationåŸºç¡€è®¾æ–½å³ä»£ç 

#### å®Œæ•´çš„Webåº”ç”¨æ ˆå®šä¹‰
```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: 'Serverless Todo Application Stack'

Parameters:
  Environment:
    Type: String
    Default: dev
    AllowedValues: [dev, staging, prod]

Resources:
  # DynamoDBè¡¨
  TodoTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub 'todos-${Environment}'
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
      KeySchema:
        - AttributeName: id
          KeyType: HASH
      StreamSpecification:
        StreamViewType: NEW_AND_OLD_IMAGES

  # Lambdaæ‰§è¡Œè§’è‰²
  LambdaRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: DynamoDBAccess
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - dynamodb:GetItem
                  - dynamodb:PutItem
                  - dynamodb:UpdateItem
                  - dynamodb:DeleteItem
                  - dynamodb:Scan
                  - dynamodb:Query
                Resource: !GetAtt TodoTable.Arn

  # Lambdaå‡½æ•°
  TodoFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub 'todo-api-${Environment}'
      Runtime: python3.9
      Handler: index.lambda_handler
      Role: !GetAtt LambdaRole.Arn
      Environment:
        Variables:
          TABLE_NAME: !Ref TodoTable
          ENVIRONMENT: !Ref Environment
      Code:
        ZipFile: |
          # Lambdaå‡½æ•°ä»£ç åœ¨è¿™é‡Œ
          def lambda_handler(event, context):
              return {'statusCode': 200, 'body': 'Hello World'}

  # API Gateway
  TodoApi:
    Type: AWS::ApiGateway::RestApi
    Properties:
      Name: !Sub 'todo-api-${Environment}'
      Description: 'Todo Application API'

  # API Gatewayèµ„æº
  TodoResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref TodoApi
      ParentId: !GetAtt TodoApi.RootResourceId
      PathPart: todos

  # API Gatewayæ–¹æ³•
  TodoGetMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref TodoApi
      ResourceId: !Ref TodoResource
      HttpMethod: GET
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TodoFunction.Arn}/invocations'

  # Lambdaæƒé™
  LambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref TodoFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${TodoApi}/*/*'

  # S3å­˜å‚¨æ¡¶ï¼ˆå‰ç«¯é™æ€æ–‡ä»¶ï¼‰
  WebsiteBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub 'todo-web-${Environment}-${AWS::AccountId}'
      WebsiteConfiguration:
        IndexDocument: index.html
        ErrorDocument: error.html
      PublicAccessBlockConfiguration:
        BlockPublicAcls: false
        BlockPublicPolicy: false
        IgnorePublicAcls: false
        RestrictPublicBuckets: false

  # CloudFrontåˆ†å‘
  CloudFrontDistribution:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        Enabled: true
        Origins:
          - DomainName: !GetAtt WebsiteBucket.RegionalDomainName
            Id: S3Origin
            S3OriginConfig:
              OriginAccessIdentity: ''
        DefaultCacheBehavior:
          TargetOriginId: S3Origin
          ViewerProtocolPolicy: redirect-to-https
          CachePolicyId: 4135ea2d-6df8-44a3-9df3-4b5a84be39ad
        PriceClass: PriceClass_100

Outputs:
  ApiEndpoint:
    Description: 'API Gateway endpoint URL'
    Value: !Sub 'https://${TodoApi}.execute-api.${AWS::Region}.amazonaws.com/prod'
    Export:
      Name: !Sub '${AWS::StackName}-ApiEndpoint'

  WebsiteURL:
    Description: 'Website URL'
    Value: !GetAtt CloudFrontDistribution.DomainName
    Export:
      Name: !Sub '${AWS::StackName}-WebsiteURL'
```

## ğŸ› ï¸ å®¹å™¨åŒ–éƒ¨ç½²å®è·µ

### Kubernetesåœ¨äº‘å¹³å°çš„åº”ç”¨

#### EKSé›†ç¾¤é…ç½®
```yaml
# eks-cluster.yaml
apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: todo-app-cluster
  region: us-west-2
  version: "1.24"

nodeGroups:
  - name: worker-nodes
    instanceType: t3.medium
    desiredCapacity: 2
    minSize: 1
    maxSize: 4
    volumeSize: 20
    ssh:
      allow: true
    iam:
      withAddonPolicies:
        autoScaler: true
        cloudWatch: true

addons:
  - name: vpc-cni
  - name: coredns
  - name: kube-proxy
  - name: aws-load-balancer-controller

cloudWatch:
  clusterLogging:
    enable: ["api", "audit", "authenticator", "controllerManager", "scheduler"]
```

#### åº”ç”¨éƒ¨ç½²é…ç½®
```yaml
# todo-app-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: todo-app
  namespace: production
spec:
  replicas: 3
  selector:
    matchLabels:
      app: todo-app
  template:
    metadata:
      labels:
        app: todo-app
    spec:
      containers:
      - name: todo-app
        image: your-ecr-repo/todo-app:latest
        ports:
        - containerPort: 3000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: database-secret
              key: url
        - name: REDIS_URL
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: redis-url
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: todo-app-service
  namespace: production
spec:
  selector:
    app: todo-app
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: todo-app-ingress
  namespace: production
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
spec:
  rules:
  - host: todo.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: todo-app-service
            port:
              number: 80
```

## ğŸ“Š äº‘æœåŠ¡ç›‘æ§ä¸è¿ç»´

### CloudWatchç›‘æ§é…ç½®

#### è‡ªå®šä¹‰æŒ‡æ ‡å’Œå‘Šè­¦
```python
import boto3
import json
from datetime import datetime

cloudwatch = boto3.client('cloudwatch')

def put_custom_metric(metric_name, value, unit='Count', namespace='TodoApp'):
    """å‘é€è‡ªå®šä¹‰æŒ‡æ ‡åˆ°CloudWatch"""
    try:
        cloudwatch.put_metric_data(
            Namespace=namespace,
            MetricData=[
                {
                    'MetricName': metric_name,
                    'Value': value,
                    'Unit': unit,
                    'Timestamp': datetime.utcnow()
                }
            ]
        )
    except Exception as e:
        print(f"Error sending metric: {e}")

def create_alarm(alarm_name, metric_name, threshold, comparison='GreaterThanThreshold'):
    """åˆ›å»ºCloudWatchå‘Šè­¦"""
    cloudwatch.put_metric_alarm(
        AlarmName=alarm_name,
        ComparisonOperator=comparison,
        EvaluationPeriods=2,
        MetricName=metric_name,
        Namespace='TodoApp',
        Period=300,
        Statistic='Sum',
        Threshold=threshold,
        ActionsEnabled=True,
        AlarmActions=[
            'arn:aws:sns:us-west-2:123456789012:todo-alerts'
        ],
        AlarmDescription=f'Alarm when {metric_name} exceeds {threshold}',
        Unit='Count'
    )
```

### æ—¥å¿—èšåˆå’Œåˆ†æ

#### CloudWatch Logs InsightsæŸ¥è¯¢
```sql
-- åˆ†æAPIé”™è¯¯ç‡
fields @timestamp, @message
| filter @message like /ERROR/
| stats count() by bin(5m)
| sort @timestamp desc

-- åˆ†æLambdaå‡½æ•°æ€§èƒ½
fields @timestamp, @duration, @billedDuration, @memorySize, @maxMemoryUsed
| filter @type = "REPORT"
| stats avg(@duration), max(@duration), min(@duration) by bin(5m)

-- åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼
fields @timestamp, requestId, userId, action
| filter action in ["create_todo", "complete_todo", "delete_todo"]
| stats count() by action, bin(1h)
| sort @timestamp desc
```

## ğŸš€ æœ€ä½³å®è·µå»ºè®®

### äº‘æ¶æ„è®¾è®¡åŸåˆ™
```
é«˜å¯ç”¨æ€§:
â€¢ å¤šå¯ç”¨åŒºéƒ¨ç½²
â€¢ è‡ªåŠ¨æ•…éšœè½¬ç§»
â€¢ è´Ÿè½½å‡è¡¡é…ç½®
â€¢ å¥åº·æ£€æŸ¥ç›‘æ§

å¯æ‰©å±•æ€§:
â€¢ è‡ªåŠ¨æ‰©ç¼©å®¹
â€¢ æ°´å¹³æ‰©å±•è®¾è®¡
â€¢ ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
â€¢ æ•°æ®åº“è¯»å†™åˆ†ç¦»

å®‰å…¨æ€§:
â€¢ æœ€å°æƒé™åŸåˆ™
â€¢ ç½‘ç»œå®‰å…¨ç»„é…ç½®
â€¢ æ•°æ®åŠ å¯†ä¼ è¾“
â€¢ å®šæœŸå®‰å…¨å®¡è®¡

æˆæœ¬ä¼˜åŒ–:
â€¢ èµ„æºä½¿ç”¨ç›‘æ§
â€¢ è‡ªåŠ¨åŒ–èµ„æºç®¡ç†
â€¢ é¢„ç•™å®ä¾‹è§„åˆ’
â€¢ æ— æœåŠ¡å™¨æ¶æ„åº”ç”¨
```

### äº‘è¿ç§»ç­–ç•¥
```
è¯„ä¼°é˜¶æ®µ:
â€¢ ç°æœ‰æ¶æ„åˆ†æ
â€¢ ä¾èµ–å…³ç³»æ¢³ç†
â€¢ æ€§èƒ½åŸºå‡†æµ‹è¯•
â€¢ æˆæœ¬æ•ˆç›Šåˆ†æ

è¿ç§»è§„åˆ’:
â€¢ åˆ†é˜¶æ®µè¿ç§»è®¡åˆ’
â€¢ é£é™©è¯„ä¼°å’Œåº”å¯¹
â€¢ å›æ»šç­–ç•¥åˆ¶å®š
â€¢ å›¢é˜ŸåŸ¹è®­è®¡åˆ’

å®æ–½é˜¶æ®µ:
â€¢ è¯•ç‚¹é¡¹ç›®éªŒè¯
â€¢ æ¸è¿›å¼è¿ç§»
â€¢ å®æ—¶ç›‘æ§è°ƒæ•´
â€¢ æ–‡æ¡£æ›´æ–°ç»´æŠ¤
``` 