# å‰ç«¯å·¥ç¨‹åŒ– - æ€»è§ˆ

## æ¦‚è¿°

å‰ç«¯å·¥ç¨‹åŒ–æ˜¯ç°ä»£Webå¼€å‘çš„æ ¸å¿ƒï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„å·¥å…·é“¾ã€æµç¨‹å’Œè§„èŒƒï¼Œæå‡å¼€å‘æ•ˆç‡ã€ä»£ç è´¨é‡å’Œé¡¹ç›®ç»´æŠ¤æ€§ã€‚æœ¬ç« èŠ‚æ¶µç›–æ„å»ºå·¥å…·ã€ä»£ç è§„èŒƒã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ€§èƒ½ä¼˜åŒ–ç­‰å‰ç«¯å·¥ç¨‹åŒ–çš„å„ä¸ªæ–¹é¢ã€‚

## ğŸ“š ç« èŠ‚å†…å®¹

### 1. [æ„å»ºå·¥å…·é“¾](./build-tools.md)
- **æ‰“åŒ…å·¥å…·**: Webpackã€Viteã€Rollupã€Parcelé…ç½®å’Œä¼˜åŒ–
- **ç¼–è¯‘è½¬æ¢**: Babelã€TypeScriptã€PostCSSã€SASSå¤„ç†
- **å¼€å‘æœåŠ¡å™¨**: HMRçƒ­æ›´æ–°ã€ä»£ç†é…ç½®ã€ç¯å¢ƒå˜é‡
- **ä»£ç åˆ†å‰²**: åŠ¨æ€å¯¼å…¥ã€è·¯ç”±åˆ†å‰²ã€æŒ‰éœ€åŠ è½½
- **èµ„æºä¼˜åŒ–**: å›¾ç‰‡å‹ç¼©ã€æ–‡ä»¶å“ˆå¸Œã€CDNé›†æˆ

### 2. [ä»£ç è´¨é‡ä¿è¯](./code-quality.md)
- **ä»£ç è§„èŒƒ**: ESLintã€Prettierã€StyleLinté…ç½®
- **ç±»å‹æ£€æŸ¥**: TypeScriptã€Flowé™æ€ç±»å‹ç³»ç»Ÿ
- **Gité’©å­**: Huskyã€lint-stagedã€commitlint
- **ä»£ç å®¡æŸ¥**: Pull Requestæµç¨‹ã€Reviewæ¸…å•
- **è´¨é‡åº¦é‡**: ä»£ç è¦†ç›–ç‡ã€å¤æ‚åº¦åˆ†æã€æŠ€æœ¯å€ºåŠ¡

### 3. [è‡ªåŠ¨åŒ–æµ‹è¯•](./automated-testing.md)
- **å•å…ƒæµ‹è¯•**: Jestã€Vitestã€Mochaæµ‹è¯•æ¡†æ¶
- **ç»„ä»¶æµ‹è¯•**: React Testing Libraryã€Vue Test Utils
- **E2Eæµ‹è¯•**: Cypressã€Playwrightã€Puppeteer
- **è§†è§‰å›å½’**: Percyã€Chromaticã€BackstopJS
- **æ€§èƒ½æµ‹è¯•**: Lighthouse CIã€Web Vitalsç›‘æ§

### 4. [CI/CDæµæ°´çº¿](./cicd-pipeline.md)
- **æŒç»­é›†æˆ**: GitHub Actionsã€GitLab CIã€Jenkins
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**: Netlifyã€Vercelã€AWS S3+CloudFront
- **ç¯å¢ƒç®¡ç†**: å¼€å‘ã€æµ‹è¯•ã€é¢„ç”Ÿäº§ã€ç”Ÿäº§ç¯å¢ƒ
- **å‘å¸ƒç­–ç•¥**: è“ç»¿éƒ¨ç½²ã€ç°åº¦å‘å¸ƒã€å›æ»šæœºåˆ¶
- **ç›‘æ§å‘Šè­¦**: é”™è¯¯ç›‘æ§ã€æ€§èƒ½ç›‘æ§ã€ç”¨æˆ·è¡Œä¸ºåˆ†æ

### 5. [æ€§èƒ½ä¼˜åŒ–](./performance-optimization.md)
- **åŠ è½½ä¼˜åŒ–**: èµ„æºå‹ç¼©ã€ç¼“å­˜ç­–ç•¥ã€CDNåŠ é€Ÿ
- **æ¸²æŸ“ä¼˜åŒ–**: è™šæ‹ŸDOMã€ç»„ä»¶æ‡’åŠ è½½ã€æœåŠ¡ç«¯æ¸²æŸ“
- **ç”¨æˆ·ä½“éªŒ**: Core Web Vitalsã€äº¤äº’ä¼˜åŒ–ã€å¯è®¿é—®æ€§
- **ç›‘æ§åˆ†æ**: RUMç›‘æ§ã€æ€§èƒ½é¢„ç®—ã€ä¼˜åŒ–å»ºè®®
- **å·¥å…·ä½¿ç”¨**: Lighthouseã€WebPageTestã€Chrome DevTools

## ğŸ¯ ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–æ¶æ„

### å·¥å…·é“¾ç”Ÿæ€ç³»ç»Ÿ

#### æ ¸å¿ƒå·¥å…·å¯¹æ¯”
| å·¥å…·ç±»å‹ | ä¸»æµé€‰æ‹© | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|----------|------|----------|
| **æ„å»ºå·¥å…·** | Vite | å¿«é€Ÿã€ESMåŸç”Ÿ | ç°ä»£é¡¹ç›® |
| | Webpack | æˆç†Ÿã€æ’ä»¶ä¸°å¯Œ | å¤æ‚é¡¹ç›® |
| **åŒ…ç®¡ç†** | pnpm | å¿«é€Ÿã€èŠ‚çœç©ºé—´ | å•ä½“ä»“åº“ |
| | npm/yarn | ç”Ÿæ€æˆç†Ÿ | é€šç”¨é¡¹ç›® |
| **æµ‹è¯•æ¡†æ¶** | Vitest | å¿«é€Ÿã€Viteé›†æˆ | Viteé¡¹ç›® |
| | Jest | åŠŸèƒ½å®Œæ•´ | Reacté¡¹ç›® |

### Viteç°ä»£æ„å»ºé…ç½®

#### å®Œæ•´çš„vite.config.ts
```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig({
  plugins: [
    react(),
    // å…¶ä»–æ’ä»¶é…ç½®
  ],
  
  // è·¯å¾„åˆ«å
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@utils': resolve(__dirname, 'src/utils'),
    },
  },
  
  // å¼€å‘æœåŠ¡å™¨é…ç½®
  server: {
    port: 3000,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ''),
      },
    },
  },
  
  // æ„å»ºé…ç½®
  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          ui: ['@mui/material', '@emotion/react'],
        },
      },
    },
  },
  
  // ç¯å¢ƒå˜é‡
  define: {
    __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
  },
});
```

### ä»£ç è´¨é‡é…ç½®

#### ESLint + Prettier + TypeScript
```json
// .eslintrc.json
{
  "extends": [
    "@typescript-eslint/recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended",
    "prettier"
  ],
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint", "react", "react-hooks"],
  "rules": {
    "react/react-in-jsx-scope": "off",
    "@typescript-eslint/no-unused-vars": "error",
    "react-hooks/exhaustive-deps": "warn"
  },
  "settings": {
    "react": {
      "version": "detect"
    }
  }
}
```

```json
// prettier.config.js
module.exports = {
  semi: true,
  singleQuote: true,
  tabWidth: 2,
  trailingComma: 'es5',
  printWidth: 80,
  bracketSpacing: true,
  arrowParens: 'avoid',
};
```

## ğŸ’¡ è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”å®è·µ

#### å•å…ƒæµ‹è¯• (70%)
```typescript
// ç»„ä»¶å•å…ƒæµ‹è¯•ç¤ºä¾‹
import { render, screen, fireEvent } from '@testing-library/react';
import { Counter } from './Counter';

describe('Counter Component', () => {
  test('renders initial count', () => {
    render(<Counter initialCount={0} />);
    expect(screen.getByText('Count: 0')).toBeInTheDocument();
  });

  test('increments count when button clicked', () => {
    render(<Counter initialCount={0} />);
    
    const button = screen.getByRole('button', { name: /increment/i });
    fireEvent.click(button);
    
    expect(screen.getByText('Count: 1')).toBeInTheDocument();
  });

  test('calls onCountChange when count updates', () => {
    const mockOnCountChange = jest.fn();
    render(<Counter initialCount={0} onCountChange={mockOnCountChange} />);
    
    const button = screen.getByRole('button', { name: /increment/i });
    fireEvent.click(button);
    
    expect(mockOnCountChange).toHaveBeenCalledWith(1);
  });
});
```

#### é›†æˆæµ‹è¯• (20%)
```typescript
// APIé›†æˆæµ‹è¯•
import { renderHook, waitFor } from '@testing-library/react';
import { QueryClient, QueryClientProvider } from 'react-query';
import { useUserProfile } from './useUserProfile';

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: { retry: false },
      mutations: { retry: false },
    },
  });
  
  return ({ children }: { children: React.ReactNode }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
};

describe('useUserProfile Hook', () => {
  test('fetches user profile successfully', async () => {
    const { result } = renderHook(() => useUserProfile('123'), {
      wrapper: createWrapper(),
    });

    await waitFor(() => {
      expect(result.current.isSuccess).toBe(true);
    });

    expect(result.current.data).toEqual({
      id: '123',
      name: 'John Doe',
      email: 'john@example.com',
    });
  });
});
```

#### E2Eæµ‹è¯• (10%)
```typescript
// Cypress E2Eæµ‹è¯•
describe('Todo App E2E', () => {
  beforeEach(() => {
    cy.visit('/');
  });

  it('should add and complete a todo item', () => {
    // æ·»åŠ å¾…åŠäº‹é¡¹
    cy.get('[data-testid=todo-input]')
      .type('Learn Cypress testing');
    
    cy.get('[data-testid=add-button]')
      .click();

    // éªŒè¯æ·»åŠ æˆåŠŸ
    cy.get('[data-testid=todo-list]')
      .should('contain', 'Learn Cypress testing');

    // å®Œæˆå¾…åŠäº‹é¡¹
    cy.get('[data-testid=todo-item]')
      .first()
      .find('[data-testid=checkbox]')
      .click();

    // éªŒè¯å®ŒæˆçŠ¶æ€
    cy.get('[data-testid=todo-item]')
      .first()
      .should('have.class', 'completed');
  });

  it('should filter todos by status', () => {
    // æ·»åŠ å¤šä¸ªå¾…åŠäº‹é¡¹
    cy.get('[data-testid=todo-input]').type('Task 1{enter}');
    cy.get('[data-testid=todo-input]').type('Task 2{enter}');
    
    // å®Œæˆç¬¬ä¸€ä¸ªä»»åŠ¡
    cy.get('[data-testid=todo-item]')
      .first()
      .find('[data-testid=checkbox]')
      .click();

    // è¿‡æ»¤æ˜¾ç¤ºå·²å®Œæˆ
    cy.get('[data-testid=filter-completed]').click();
    cy.get('[data-testid=todo-list]')
      .should('contain', 'Task 1')
      .should('not.contain', 'Task 2');

    // è¿‡æ»¤æ˜¾ç¤ºæœªå®Œæˆ
    cy.get('[data-testid=filter-active]').click();
    cy.get('[data-testid=todo-list]')
      .should('contain', 'Task 2')
      .should('not.contain', 'Task 1');
  });
});
```

## ğŸ› ï¸ CI/CDè‡ªåŠ¨åŒ–æµç¨‹

### GitHub Actionså·¥ä½œæµ

#### å®Œæ•´çš„CI/CDé…ç½®
```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [16.x, 18.x]
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run linting
        run: npm run lint
      
      - name: Run type checking
        run: npm run type-check
      
      - name: Run unit tests
        run: npm run test:unit -- --coverage
      
      - name: Upload coverage reports
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
      
      - name: Run E2E tests
        run: npm run test:e2e
        env:
          CI: true

  build:
    needs: test
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build application
        run: npm run build
        env:
          NODE_ENV: production
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build-files
          path: dist/

  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: build-files
          path: dist/
      
      - name: Deploy to S3
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_REGION: 'us-east-1'
        run: |
          aws s3 sync dist/ s3://${{ secrets.S3_BUCKET_NAME }} --delete
          
      - name: Invalidate CloudFront
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_REGION: 'us-east-1'
        run: |
          aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/*"

  lighthouse:
    needs: deploy
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Run Lighthouse CI
        run: |
          npm install -g @lhci/cli@0.12.x
          lhci autorun
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å®è·µ

### Webæ€§èƒ½æŒ‡æ ‡ç›‘æ§

#### Core Web Vitalsç›‘æ§
```typescript
// æ€§èƒ½ç›‘æ§å·¥å…·
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric: any) {
  // å‘é€åˆ°åˆ†ææœåŠ¡
  gtag('event', metric.name, {
    event_category: 'Web Vitals',
    event_label: metric.id,
    value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
    non_interaction: true,
  });
}

// ç›‘æ§æ‰€æœ‰æ ¸å¿ƒæŒ‡æ ‡
getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getFCP(sendToAnalytics);
getLCP(sendToAnalytics);
getTTFB(sendToAnalytics);
```

### æ„å»ºä¼˜åŒ–ç­–ç•¥

#### Webpack Bundleåˆ†æ
```javascript
// webpack-bundle-analyzeré…ç½®
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;

module.exports = {
  // ... å…¶ä»–é…ç½®
  plugins: [
    new BundleAnalyzerPlugin({
      analyzerMode: 'static',
      openAnalyzer: false,
      reportFilename: 'bundle-report.html',
    }),
  ],
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all',
        },
        common: {
          name: 'common',
          minChunks: 2,
          chunks: 'all',
          enforce: true,
        },
      },
    },
  },
};
```

## ğŸš€ æœ€ä½³å®è·µå»ºè®®

### é¡¹ç›®ç»“æ„è§„èŒƒ
```
src/
â”œâ”€â”€ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ ui/             # åŸºç¡€UIç»„ä»¶
â”‚   â””â”€â”€ feature/        # ä¸šåŠ¡åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hook
â”œâ”€â”€ services/           # APIæœåŠ¡
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ stores/             # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ types/              # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ styles/             # æ ·å¼æ–‡ä»¶
â””â”€â”€ tests/              # æµ‹è¯•æ–‡ä»¶
    â”œâ”€â”€ __mocks__/      # Mockæ–‡ä»¶
    â”œâ”€â”€ fixtures/       # æµ‹è¯•æ•°æ®
    â””â”€â”€ utils/          # æµ‹è¯•å·¥å…·
```

### å¼€å‘å·¥ä½œæµ
```
1. éœ€æ±‚åˆ†æå’Œè®¾è®¡
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹
4. å®ç°åŠŸèƒ½ä»£ç 
5. æœ¬åœ°æµ‹è¯•éªŒè¯
6. ä»£ç è´¨é‡æ£€æŸ¥
7. æäº¤PRå®¡æŸ¥
8. åˆå¹¶ä¸»åˆ†æ”¯
9. è‡ªåŠ¨éƒ¨ç½²å‘å¸ƒ
10. ç›‘æ§å’Œåé¦ˆ
``` 